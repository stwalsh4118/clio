# 3-1 Research git library and design git commit monitoring strategy

[Back to task list](./tasks.md)

## Description

Research the go-git library API, answer open questions from the PBI PRD, and design the git commit monitoring strategy. This research task will inform the design and implementation of subsequent tasks by establishing how to use go-git for repository operations, commit detection, and diff extraction.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-16 00:55:17 | Created | N/A | Proposed | Task file created | System |
| 2025-11-16 12:00:00 | Status Update | Proposed | Review | Research completed, documentation created | AI Agent |

## Requirements

1. Research go-git library (`github.com/go-git/go-git/v5`) API and capabilities
2. Document how to:
   - Open and access git repositories
   - List commits in a repository
   - Extract commit metadata (hash, message, timestamp, author, branch)
   - Extract commit diffs
   - Handle large repositories efficiently
   - Detect new commits since last check
3. Answer open questions from PRD:
   - Commit filtering: Should we capture all commits or filter by branch/author?
   - Diff size limits: Should we limit diff size or truncate very large diffs?
   - Merge commits: How should we handle merge commits? Include or exclude?
   - Commit correlation: How precise should timestamp correlation be? Within 5 minutes? Same hour?
   - Repository changes: How do we handle repositories that are moved or deleted?
4. Design polling strategy:
   - Determine polling interval (default: 30 seconds, configurable)
   - Design commit tracking mechanism (store last seen commit hash per repository)
   - Design efficient commit detection (compare HEAD commit hash)
   - Handle multiple repositories concurrently
5. Document findings in a research guide file
6. Create API specification document for git operations

## Implementation Plan

1. Research go-git library:
   - Review go-git documentation and examples
   - Identify key functions for repository operations
   - Test basic operations (open repo, list commits, get diffs)
   - Document API patterns and best practices
2. Answer PRD open questions:
   - Commit filtering: Recommend capturing all commits on all branches (can filter later)
   - Diff size limits: Recommend truncating diffs >5000 lines with note, full diff available via git
   - Merge commits: Recommend including merge commits with special marking
   - Commit correlation: Recommend 5-minute window for correlation precision
   - Repository changes: Recommend periodic re-scan of watched directories, handle missing repos gracefully
3. Design polling strategy:
   - Use periodic polling (every 30 seconds by default, configurable)
   - Store last seen commit hash per repository in memory/database
   - Compare current HEAD commit hash with last seen hash
   - If different, fetch commits between last seen and HEAD
   - Handle concurrent polling of multiple repositories
4. Document findings:
   - Create research guide: `docs/delivery/3/3-1-go-git-guide.md`
   - Include API usage examples, patterns, and code snippets
   - Date-stamp the document and link to original go-git documentation
   - Create API specification: `docs/api-specs/git/git-api.md`
   - Document git service interfaces and data structures

## Test Plan

**Objective**: Verify research findings are accurate and go-git library can be used effectively for the required operations.

**Test Scope**:
- Library API understanding
- Basic operations validation
- Performance considerations
- Design validation

**Key Test Scenarios**:
1. Verify go-git can open repositories from file paths
2. Verify go-git can list commits efficiently
3. Verify commit metadata can be extracted
4. Verify diffs can be extracted
5. Verify large repositories are handled efficiently
6. Verify commit detection strategy works

**Success Criteria**:
- All go-git operations documented
- All PRD open questions answered with recommendations
- Polling strategy designed and documented
- Research guide complete with examples
- API specification document created

## Verification

- [x] go-git library API researched and documented
- [x] Commit filtering strategy decided
- [x] Diff size limit strategy decided
- [x] Merge commit handling strategy decided
- [x] Commit correlation precision decided
- [x] Repository change handling strategy decided
- [x] Polling strategy designed
- [x] Research guide document created
- [x] API specification document created
- [x] All open questions from PRD answered

## Files Modified

- `docs/delivery/3/3-1-go-git-guide.md` (new) - Research findings and go-git usage guide
- `docs/api-specs/git/git-api.md` (new) - Git service API specification

