# 2-10 E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end testing to verify all 11 acceptance criteria from PBI 2 are met. This comprehensive test ensures the complete Cursor conversation capture system works as specified in the PBI Conditions of Satisfaction.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 22:41:32 | Created | N/A | Proposed | Task file created | System |

## Requirements

Verify all 11 Conditions of Satisfaction from PBI 2:

1. System successfully locates Cursor log directory on macOS and Linux
2. File system watcher detects new conversation files in Cursor log directory
3. Parser successfully extracts messages from Cursor log format
4. System correctly identifies user messages vs agent responses
5. Conversations are exported to markdown files in correct directory structure
6. Markdown files are human-readable and well-formatted
7. Session boundaries are correctly determined (time-based or manual)
8. System handles file system events without blocking
9. System continues operating stably for 8+ hour sessions
10. Multiple concurrent conversations are handled correctly
11. System gracefully handles Cursor log format variations

## Implementation Plan

1. Create comprehensive end-to-end test suite:
   - Test file: `test/e2e/pbi2_cos_test.go`
   - Location: `app/test/e2e/`
2. Set up test environment:
   - Use temporary directories for Cursor log simulation
   - Create mock Cursor log files in test format
   - Use temporary directory for export output (`~/.clio/sessions/`)
   - Clean up after each test
   - Isolate tests from user's actual directories
3. Implement test cases for each CoS:
   - **CoS 1**: Test log directory discovery on macOS and Linux (or simulate)
   - **CoS 2**: Test file system watcher detects new files
   - **CoS 3**: Test parser extracts messages correctly
   - **CoS 4**: Test user vs agent message identification
   - **CoS 5**: Test markdown export creates correct directory structure
   - **CoS 6**: Test markdown files are readable and well-formatted
   - **CoS 7**: Test session boundary detection (time-based)
   - **CoS 8**: Test non-blocking file system event handling
   - **CoS 9**: Test system stability over extended period (simulated)
   - **CoS 10**: Test multiple concurrent conversations
   - **CoS 11**: Test graceful handling of format variations
4. Create test helpers:
   - Setup temporary Cursor log directory
   - Create mock conversation log files
   - Execute capture system programmatically
   - Verify exported markdown files
   - Clean up test artifacts
5. Create mock Cursor log files:
   - Use format determined in task 2-1
   - Include various scenarios (normal, edge cases, format variations)
6. Implement long-running stability test:
   - Simulate 8+ hour session with multiple conversations
   - Verify system doesn't leak resources
   - Verify all conversations captured correctly
7. Document test execution instructions

## Test Plan

**Objective**: Verify all 11 PBI acceptance criteria are met through comprehensive end-to-end testing.

**Test Scope**: 
- All 11 Conditions of Satisfaction
- Complete capture workflow
- File system watching
- Parsing and export
- Session tracking
- Error handling
- Stability and concurrency

**Environment & Setup**:
- Use temporary directories for test isolation
- Mock Cursor log files with known structure
- Simulate file system events
- Test on both macOS and Linux if possible (or simulate)

**Key Test Scenarios**:

1. **CoS 1**: Verify Cursor log directory located on macOS
2. **CoS 1**: Verify Cursor log directory located on Linux
3. **CoS 2**: Verify file system watcher detects new conversation files
4. **CoS 3**: Verify parser extracts messages from log format
5. **CoS 4**: Verify user messages identified correctly
6. **CoS 4**: Verify agent responses identified correctly
7. **CoS 5**: Verify markdown files exported to correct directory structure (`YYYY-MM-DD/<project>/`)
8. **CoS 6**: Verify markdown files are human-readable
9. **CoS 6**: Verify markdown files are well-formatted
10. **CoS 7**: Verify session boundaries determined correctly (time-based)
11. **CoS 8**: Verify file system events handled without blocking
12. **CoS 9**: Verify system operates stably for extended period (8+ hours simulated)
13. **CoS 10**: Verify multiple concurrent conversations handled correctly
14. **CoS 11**: Verify Cursor log format variations handled gracefully

**Success Criteria**:
- All 11 test scenarios pass
- Tests are repeatable and isolated
- Test coverage verifies complete PBI functionality
- Tests can be run as part of CI/CD pipeline
- Long-running stability test passes

## Verification

- [ ] Test suite created for E2E CoS testing
- [ ] All 11 acceptance criteria have corresponding test cases
- [ ] Tests use temporary directories for isolation
- [ ] CoS 1: Log directory discovery verified (macOS and Linux)
- [ ] CoS 2: File system watcher verified
- [ ] CoS 3: Parser message extraction verified
- [ ] CoS 4: User vs agent identification verified
- [ ] CoS 5: Directory structure verified
- [ ] CoS 6: Markdown readability and formatting verified
- [ ] CoS 7: Session boundary detection verified
- [ ] CoS 8: Non-blocking event handling verified
- [ ] CoS 9: Extended stability verified
- [ ] CoS 10: Concurrent conversations verified
- [ ] CoS 11: Format variation handling verified
- [ ] All tests compile successfully
- [ ] All tests pass

## Files Modified

- `app/test/e2e/pbi2_cos_test.go` (new) - Main test file with all 11 CoS test cases
- `app/test/e2e/pbi2_helpers.go` (new) - Helper functions for PBI 2 E2E tests
- `app/test/e2e/README.md` (updated) - Documentation for PBI 2 E2E tests

