# 2-11 E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end testing to verify all 11 acceptance criteria from PBI 2 are met. This comprehensive test ensures the complete Cursor conversation capture system works as specified in the PBI Conditions of Satisfaction.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 22:41:32 | Created | N/A | Proposed | Task file created | System |

## Requirements

Verify all 11 Conditions of Satisfaction from PBI 2:

1. System successfully locates Cursor log directory on macOS and Linux
2. File system watcher detects new conversation files in Cursor log directory
3. Parser successfully extracts messages from Cursor log format
4. System correctly identifies user messages vs agent responses
5. Conversations are exported to markdown files in correct directory structure
6. Markdown files are human-readable and well-formatted
7. Session boundaries are correctly determined (time-based or manual)
8. System handles file system events without blocking
9. System continues operating stably for 8+ hour sessions
10. Multiple concurrent conversations are handled correctly
11. System gracefully handles Cursor log format variations

## Implementation Plan

1. Create E2E test file:
   - Location: `test/e2e/pbi2_cos_test.go`
   - Package: `e2e`
2. Set up test environment:
   - Create temporary Cursor log directory structure
   - Create sample SQLite database with conversation data
   - Set up temporary output directory for markdown files
3. Test each CoS:
   - Test 1: Verify log directory location on different platforms
   - Test 2: Create/modify database file, verify watcher detects it
   - Test 3: Verify parser extracts messages correctly
   - Test 4: Verify user vs agent identification
   - Test 5: Verify markdown export creates correct directory structure
   - Test 6: Verify markdown file format and readability
   - Test 7: Verify session boundary detection
   - Test 8: Verify non-blocking event handling
   - Test 9: Run extended test (simulate 8+ hours)
   - Test 10: Create multiple concurrent conversations, verify handling
   - Test 11: Test with various log format variations
4. Integration test:
   - Start daemon with test configuration
   - Simulate Cursor activity (database modifications)
   - Verify end-to-end flow: watcher → parser → project detector → session tracker → exporter
   - Verify markdown files are created correctly
5. Cleanup:
   - Stop daemon gracefully
   - Clean up temporary files and directories

## Test Plan

**Objective**: Verify complete Cursor conversation capture system meets all acceptance criteria.

**Test Scope**:
- All 11 Conditions of Satisfaction
- End-to-end integration
- System stability
- Error handling

**Environment & Setup**:
- Test with temporary directories
- Mock Cursor database structure
- Test on both macOS and Linux if possible
- Extended stability test (8+ hours simulated)

**Key Test Scenarios**:
1. Verify log directory discovery on different platforms
2. Verify file watcher detects database modifications
3. Verify parser extracts all messages correctly
4. Verify user vs agent message identification
5. Verify markdown export creates correct directory structure
6. Verify markdown files are readable and well-formatted
7. Verify session boundaries are detected correctly
8. Verify system handles events without blocking
9. Verify system stability over extended period
10. Verify multiple concurrent conversations handled correctly
11. Verify graceful handling of format variations

**Success Criteria**:
- All 11 CoS verified and passing
- End-to-end flow works correctly
- System operates stably
- Error handling works correctly

## Verification

- [ ] Test 1: Log directory location verified
- [ ] Test 2: File watcher detects changes
- [ ] Test 3: Parser extracts messages
- [ ] Test 4: User vs agent identification works
- [ ] Test 5: Markdown export directory structure correct
- [ ] Test 6: Markdown files readable and formatted
- [ ] Test 7: Session boundaries detected correctly
- [ ] Test 8: Non-blocking event handling verified
- [ ] Test 9: Extended stability test passes
- [ ] Test 10: Multiple concurrent conversations handled
- [ ] Test 11: Format variations handled gracefully
- [ ] All E2E tests passing

## Files Modified

- `test/e2e/pbi2_cos_test.go` (new) - E2E test for PBI 2 CoS
- `test/e2e/helpers.go` (updated) - Test helper functions for Cursor capture

