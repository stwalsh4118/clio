# 2-2 Implement Cursor log discovery service

[Back to task list](./tasks.md)

## Description

Implement a service to locate and validate Cursor log directory paths on different platforms (macOS and Linux). This service will be used by other components to find where Cursor stores its conversation logs.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 22:41:32 | Created | N/A | Proposed | Task file created | System |

## Requirements

1. Detect current operating system (macOS vs Linux)
2. Return correct Cursor log directory path based on platform
3. Validate that the directory exists
4. Validate that the directory is readable
5. Provide helpful error messages if directory cannot be found
6. Handle edge cases (Cursor not installed, permissions issues, etc.)
7. Export a clean interface for other components to use

## Implementation Plan

1. Create discovery service package:
   - Location: `internal/cursor/discovery.go` or similar
   - Package: `cursor` or `cursorlog`
2. Implement platform detection:
   - Use `runtime.GOOS` to detect platform
   - Support macOS and Linux
3. Define log directory paths:
   - macOS: `~/Library/Application Support/Cursor/` (or path from research)
   - Linux: `~/.cursor/` or `~/.config/cursor/` (or path from research)
   - Use `os.UserHomeDir()` to resolve home directory
4. Implement validation:
   - Check if directory exists using `os.Stat()`
   - Check if directory is readable
   - Return appropriate errors if validation fails
5. Create service interface:
   ```go
   type DiscoveryService interface {
       GetLogDirectory() (string, error)
       ValidateLogDirectory(path string) error
   }
   ```
6. Add logging for discovery operations
7. Write unit tests for platform detection and path resolution

## Test Plan

**Objective**: Verify Cursor log directory can be discovered and validated on different platforms.

**Test Scope**:
- Platform detection
- Path resolution
- Directory validation
- Error handling

**Environment & Setup**:
- Unit tests with mocked file system
- Test on actual macOS/Linux if possible

**Key Test Scenarios**:
1. Detect macOS platform and return correct path
2. Detect Linux platform and return correct path
3. Resolve home directory correctly
4. Validate existing directory successfully
5. Return error for non-existent directory
6. Return error for non-readable directory
7. Handle missing home directory gracefully

**Success Criteria**:
- Correct paths returned for each platform
- Validation works correctly
- Error messages are helpful
- Service can be used by other components

## Verification

- [ ] Platform detection implemented
- [ ] macOS path resolution works
- [ ] Linux path resolution works
- [ ] Directory existence validation works
- [ ] Directory readability validation works
- [ ] Error handling implemented
- [ ] Unit tests written and passing
- [ ] Service interface exported
- [ ] Logging added

## Files Modified

- `internal/cursor/discovery.go` (new) - Cursor log discovery service
- `internal/cursor/discovery_test.go` (new) - Unit tests for discovery service
- `docs/api-specs/cursor/cursor-api.md` (new or updated) - API specification for cursor services

