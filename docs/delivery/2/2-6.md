# 2-6 Implement markdown export functionality

[Back to task list](./tasks.md)

## Description

Implement export functionality to write conversation sessions to markdown files in the date/project directory structure. This component converts structured conversation data into human-readable markdown format.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 22:41:32 | Created | N/A | Proposed | Task file created | System |

## Requirements

1. Export conversations to markdown format
2. Organize files by date: `~/.clio/sessions/YYYY-MM-DD/`
3. Organize files by project: `~/.clio/sessions/YYYY-MM-DD/<project-name>/`
4. File naming: `conversation-001.md`, `conversation-002.md`, etc.
5. Markdown format matches specification from PRD
6. Create directory structure if it doesn't exist
7. Handle file naming conflicts (increment counter)
8. Write files atomically (avoid partial writes)
9. Format markdown for readability

## Implementation Plan

1. Create markdown exporter service:
   - Location: `internal/cursor/exporter.go`
   - Package: `cursor`
2. Define exporter interface:
   ```go
   type Exporter interface {
       ExportSession(session *Session) error
       GetExportPath(session *Session) string
   }
   ```
3. Implement directory structure creation:
   - Base path: `~/.clio/sessions/`
   - Date directory: `YYYY-MM-DD/`
   - Project directory: `<project-name>/`
   - Create directories if they don't exist
4. Implement file naming logic:
   - Generate sequential file names: `conversation-001.md`, `conversation-002.md`
   - Check for existing files and increment counter
   - Handle edge cases (many files, gaps in numbering)
5. Implement markdown generation:
   - Format session header with metadata
   - Format each message with timestamp and role
   - Use proper markdown formatting (headers, code blocks, etc.)
   - Format according to PRD specification:
     ```markdown
     # Conversation Session: 2025-01-27 14:30:00
     
     **Project**: stream-tv
     **Session ID**: abc123
     **Duration**: 45 minutes
     **Message Count**: 12
     
     ---
     
     ## User Message (14:30:15)
     
     How do I debug websocket connection issues in Go?
     
     ## Agent Response (14:30:22)
     
     To debug websocket connection issues, you can...
     ```
6. Implement atomic file writing:
   - Write to temporary file first
   - Rename to final location on success
   - Clean up temp file on error
7. Handle special characters in markdown:
   - Escape markdown special characters in content
   - Preserve code blocks and formatting
8. Write unit tests for markdown generation

## Test Plan

**Objective**: Verify markdown export creates correctly formatted files in proper directory structure.

**Test Scope**:
- Directory structure creation
- File naming
- Markdown formatting
- Atomic file writing
- Special character handling

**Environment & Setup**:
- Use temporary directories for testing
- Test with sample sessions
- Verify markdown output

**Key Test Scenarios**:
1. Create date directory structure correctly
2. Create project subdirectory correctly
3. Generate sequential file names correctly
4. Handle file naming conflicts (increment counter)
5. Generate markdown with correct format
6. Format session header correctly
7. Format messages correctly (user vs agent)
8. Handle timestamps correctly
9. Write files atomically
10. Handle special characters in content
11. Create multiple files in same directory

**Success Criteria**:
- Directory structure created correctly
- File names are sequential and unique
- Markdown format matches specification
- Files written atomically
- Content is readable and well-formatted

## Verification

- [ ] Exporter service implemented
- [ ] Directory structure creation works
- [ ] File naming logic implemented
- [ ] Markdown generation implemented
- [ ] Session header formatted correctly
- [ ] Messages formatted correctly
- [ ] Atomic file writing implemented
- [ ] Special characters handled
- [ ] Unit tests written and passing
- [ ] Export files are readable

## Files Modified

- `internal/cursor/exporter.go` (new) - Markdown export implementation
- `internal/cursor/exporter_test.go` (new) - Unit tests for exporter
- `docs/api-specs/cursor/cursor-api.md` (updated) - API specification

