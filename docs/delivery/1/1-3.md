# 1-3 Implement configuration management with Viper

[Back to task list](./tasks.md)

## Description

Set up Viper for configuration file management, environment variable support, and default values. This provides the configuration infrastructure needed for storing and retrieving application settings.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 01:41:47 | Created | N/A | Proposed | Task file created | System |
| 2025-11-14 16:42:42 | Status Change | Proposed | Done | Task completed - Viper configuration management implemented with config structs, loader, defaults, and home directory expansion | AI Agent |

## Requirements

1. Add Viper dependency to go.mod
2. Create configuration structure/types to represent config schema
3. Set up Viper to read from:
   - Configuration file (`~/.clio/config.yaml`)
   - Environment variables (with CLIO_ prefix)
   - Default values
4. Implement configuration loading logic
5. Define default configuration values matching the schema in PBI PRD
6. Support configuration file creation if it doesn't exist (deferred to task 1-7)
7. Handle configuration file path resolution (home directory expansion)

## Implementation Plan

1. Add Viper dependency: `go get github.com/spf13/viper`
2. Create `internal/config/` directory for configuration code
3. Define configuration struct in `internal/config/config.go`:
   - WatchedDirectories ([]string)
   - BlogRepository (string)
   - Storage (StorageConfig struct)
   - Cursor (CursorConfig struct)
   - Session (SessionConfig struct)
4. Create `internal/config/loader.go` with functions to:
   - Initialize Viper with config file path
   - Set default values
   - Configure environment variable prefix (CLIO_)
   - Load configuration from file and environment
   - Return configuration struct
5. Create helper functions for:
   - Expanding home directory paths (~)
   - Validating configuration paths
6. Export a `Load()` or `GetConfig()` function that other packages can use

## Test Plan

**Objective**: Verify Viper is correctly configured and can load configuration from file and environment variables.

**Test Scope**:
- Viper dependency installation
- Configuration structure definition
- Configuration loading logic
- Default values
- Environment variable support

**Key Test Scenarios**:
1. Viper dependency is added successfully
2. Configuration struct matches schema from PBI PRD
3. Default values are set correctly
4. Configuration can be loaded from file (when file exists)
5. Environment variables with CLIO_ prefix override file values
6. Home directory paths (~) are expanded correctly
7. Configuration loading handles missing file gracefully

**Success Criteria**:
- Viper dependency added to go.mod
- Configuration structure defined
- Configuration loader functions work correctly
- Default values match PBI PRD schema
- Environment variable support works

## Verification

- [x] Viper dependency added to go.mod
- [x] Configuration struct defined in `internal/config/config.go`
- [x] Configuration loader implemented in `internal/config/loader.go`
- [x] Default values match PBI PRD schema
- [x] Environment variable prefix (CLIO_) configured
- [x] Home directory path expansion works
- [x] Configuration can be loaded successfully

## Files Modified

- `go.mod` (updated with Viper dependency)
- `go.sum` (updated)
- `internal/config/config.go` (new)
- `internal/config/loader.go` (new)
- `internal/config/loader_test.go` (new)
- `config.example.yaml` (new)


