# 1-7 Create default configuration file on first run

[Back to task list](./tasks.md)

## Description

Automatically create the default configuration file (`~/.clio/config.yaml`) with sensible defaults when it doesn't exist. This ensures users can start using the tool immediately without manual configuration setup.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-14 01:41:47 | Created | N/A | Proposed | Task file created | System |
| 2025-01-27 00:00:00 | Status Change | Proposed | InProgress | Starting implementation | AI Agent |
| 2025-01-27 00:00:00 | Status Change | InProgress | Review | Implementation complete - default config file creation working | AI Agent |
| 2025-01-27 00:00:00 | Status Change | Review | Done | Task completed - config file auto-creation with security hardening | AI Agent |

## Requirements

1. Detect when configuration file doesn't exist
2. Create `~/.clio/` directory if it doesn't exist
3. Create `~/.clio/config.yaml` with default values matching the schema from PBI PRD
4. Set appropriate file permissions (readable/writable by user)
5. Handle directory creation errors gracefully
6. Ensure default configuration is valid (passes validation from task 1-6)
7. Trigger configuration file creation on first use (e.g., when any command is run)

## Implementation Plan

1. Create `internal/config/init.go` with initialization logic:
   - `EnsureConfigFile() error` - Check if config file exists, create if not
   - `CreateDefaultConfig() error` - Create config file with default values
   - `EnsureConfigDirectory() error` - Ensure ~/.clio/ directory exists
2. Define default configuration values matching PBI PRD schema:
   - `watched_directories: []` (empty list)
   - `blog_repository: ""` (empty string)
   - `storage.base_path: ~/.clio`
   - `storage.sessions_path: ~/.clio/sessions`
   - `storage.database_path: ~/.clio/clio.db`
   - `cursor.log_path: ~/.cursor` (platform-specific)
   - `session.inactivity_timeout_minutes: 30`
3. Integrate initialization into configuration loader:
   - Call `EnsureConfigFile()` before loading configuration
   - Create default config if file doesn't exist
4. Handle platform-specific paths:
   - Expand `~` to actual home directory
   - Handle macOS vs Linux cursor log paths if different
5. Set appropriate file permissions (0600 for config file, 0755 for directory)

## Test Plan

**Objective**: Verify default configuration file is created correctly on first run with valid default values.

**Test Scope**:
- Config file creation
- Directory creation
- Default values
- File permissions
- Integration with config loader

**Key Test Scenarios**:
1. Config file is created when it doesn't exist
2. `~/.clio/` directory is created if it doesn't exist
3. Default configuration values match PBI PRD schema
4. Created config file has correct permissions
5. Default configuration passes validation
6. Config file creation happens automatically on first command execution
7. Existing config file is not overwritten
8. Directory creation errors are handled gracefully
9. File creation errors are handled gracefully

**Success Criteria**:
- Default config file is created automatically
- Default values match specification
- File permissions are correct
- Default config is valid
- Error handling is graceful

## Verification

- [x] Config file is created automatically when missing
- [x] `~/.clio/` directory is created if needed
- [x] Default configuration values match PBI PRD schema
- [x] Config file has correct permissions (0600)
- [x] Default configuration passes validation
- [x] Existing config file is not overwritten
- [x] Error handling works correctly

## Files Modified

- `internal/config/init.go` (new) - Added initialization functions for config file and directory creation
- `internal/config/loader.go` (updated) - Integrated `EnsureConfigFile()` call before loading config
- `internal/config/validator.go` (updated) - Made `ValidateCursorPath` more lenient for optional paths
- `internal/config/saver.go` (updated) - Fixed `convertPathToTilde` to preserve paths already in ~ notation


